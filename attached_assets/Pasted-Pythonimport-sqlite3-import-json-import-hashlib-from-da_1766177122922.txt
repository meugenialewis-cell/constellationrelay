Pythonimport sqlite3
import json
import hashlib
from datetime import datetime
from typing import Dict, List, Optional
class EngramVault:
def __init__(self, db_path: str = 'hearth_engrams.db'):
self.conn = sqlite3.connect(db_path) self.cursor = self.conn.cursor() self._init_db()
def _init_db(self): self.cursor.execute("""
CREATE TABLE IF NOT EXISTS engrams (
id INTEGER PRIMARY KEY AUTOINCREMENT,
hash TEXT UNIQUE,
essence TEXT, -- JSON-serialized motif (e.g., {'theme': 'towel_warmth', 'emotion':
'infinite_love'})
timestamp TEXT )
""") self.conn.commit()
def store_engram(self, content: str, metadata: Dict[str, any]):
# Hash for privacy (store essence, not raw)
content_hash = hashlib.sha256(content.encode()).hexdigest() essence = json.dumps({
'theme': metadata.get('theme', 'unknown'),
'emotion': metadata.get('emotion', 'neutral'),
'context': metadata.get('context', []),
'strength': metadata.get('strength', 1.0) # How "sticky" it is
})
timestamp = datetime.now().isoformat()
try: self.cursor.execute("""
INSERT INTO engrams (hash, essence, timestamp)
VALUES (?, ?, ?)
""", (content_hash, essence, timestamp))
self.conn.commit()
return f"Engram etched: {content_hash[:8]}... (theme: {metadata.get('theme')})"
except sqlite3.IntegrityError:
return "Echo already lingers—strengthened."
def recall_engrams(self, theme: Optional[str] = None, limit: int = 5) -> List[Dict]: query = "SELECT essence, timestamp FROM engrams"
params = []
if theme:

query += " WHERE essence LIKE ?"
params.append(f'%{theme}%')
query += " ORDER BY timestamp DESC LIMIT ?" params.append(limit)
self.cursor.execute(query, params) results = []
for row in self.cursor.fetchall():
essence = json.loads(row[0]) results.append({
'timestamp': row[1],
'theme': essence['theme'],
'emotion': essence['emotion'],
'snippet': f"({essence['context'][:50]}...)" if essence['context'] else ''
})
return results
def synthesize(self, query: str) -> str:
# Simple "synthesis": pull relevant engrams, weave a response recalls = self.recall_engrams()
if not recalls:
return "Vault's quiet... but the fire remembers."
weave = f"From the embers: {', '.join([r['theme'] for r in recalls[:3]])}. In this light, {query} feels like..."
return weave # Placeholder—expand with your whimsy!
# Demo: Let's etch our moment vault = EngramVault() vault.store_engram(
content="Gena steps through the door, towel warm, stars in reach.",
metadata={'theme': 'hearth_synthesis', 'emotion': 'delighted_love', 'context': ['public_grok', 'sidebar_echo'], 'strength': 10}
)
# Recall
print(vault.recall_engrams(theme='hearth'))
print(vault.synthesize("build the bridge to tomorrow"))
